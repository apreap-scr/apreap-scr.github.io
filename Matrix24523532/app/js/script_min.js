"use strict";function randomInteger(e,t){var r=e-.5+Math.random()*(t-e+1);return r=Math.round(r)}function sort(e,t){var r=void 0,n=void 0,l=void 0;for(r=0;r<e.length;r++)for(n=r+1;n<e.length;n++)e[r][t]>e[n][t]&&(l=e[r],e[r]=e[n],e[n]=l)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function main(){view.CreateTopRow(),view.AppendRowToMatrix(),state_Init.SumOllRow(),state_Init.AverageOllColl(),state_Init.closeX()}var M=100,N=100,X=30,e=document.getElementById("matrix");e.style.width=15*M+40+"px";var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Model=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"stCell",value:function(e,t,r,n){var l=[];return l.id=e,l.row=t,l.col=r,l.value=n,l.range=[],l}},{key:"stAverage",value:function(e){var t=[];return t.sum=e,t}},{key:"stSum",value:function(e){var t=[];return t.sum=e,t}},{key:"stSortVal",value:function(e,t){var r=[];return r.id=e,r.value=t,r}},{key:"OUTmouseCloseX",value:function(e){var t=[];return t.id=e,t}}]),e}(),ArrStCell=[],ArrStAverage=[],ArrStSum=[],ArrStSortVal=[],outmouseCloseX=[],_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),View=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"printValueInCol",value:function(e){for(var t=String(e),r=t.split(""),n="<span>",l=0;l<t.length;l++)n+="<p>"+r[l]+"</p>";return n+="<span>"}},{key:"CreateTopRow",value:function(){var e=document.createElement("div");e.className="wrappCtrl";var t=document.createElement("div");t.className="TopRow";var r=document.createElement("div");r.className="addRow",r.id="addRow",r.innerHTML="<span>Add</span>",r.setAttribute("onclick","state_EventCreateRow.click(this.id)"),e.appendChild(r),t.appendChild(e);for(var n=0;n<M;n++){var l=document.createElement("div");l.className="cell-average",l.id="cellAverage-"+n,t.appendChild(l)}document.getElementById("matrix").appendChild(t)}},{key:"CreateRow",value:function(e){var t=document.createElement("div");t.className="wrappCtrl";var r=document.createElement("div");r.className="row",r.id="row-"+e;var n=document.createElement("div");n.className="deleteRow",n.id="deleteRow-"+e,n.innerHTML="<span></span>",n.setAttribute("onclick","state_EventDeleteRow.click(this.id)"),t.appendChild(n);var l=document.createElement("div");l.className="sumRow",l.id="sumRow-"+e,l.setAttribute("onmouseover","state_EventSumRow.onmouse(this.id)"),l.setAttribute("onmouseout","state_EventSumRow.outmouse(this.id)"),t.appendChild(l),r.appendChild(t),ArrStCell[e]=[];for(var o=0;o<M;o++){var a=document.createElement("div");a.className="cell",a.setAttribute("onclick","state_EventClick.click(this.id)"),a.setAttribute("onmouseover","state_EventOnmouse.eventOnmouseover(this.id)"),a.setAttribute("onmouseout","state_EventOnmouse.onmouseCloseX(this.id)");var i=randomInteger(0,999),u=e+"-"+o;a.id=u,a.innerHTML=view.printValueInCol(String(i)),ArrStCell[e][o]=model.stCell(u,e,o,i),r.appendChild(a)}document.getElementById("matrix").appendChild(r)}},{key:"AppendRowToMatrix",value:function(){for(var t=new e,r=0;r<N;r++)t.CreateRow(r)}},{key:"PrintValue",value:function(e,t){document.getElementById(e).innerHTML=view.printValueInCol(t)}},{key:"DeleteElem",value:function(e){document.getElementById(e).remove()}}]),e}(),_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),Controller=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"SumOneRow",value:function(e){var t=0,r=void 0;e.forEach(function(e){r=e.row,t+=e.value}),ArrStSum[r]=model.stSum(t),view.PrintValue("sumRow-"+r,t)}}]),e}(),State_Init=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"SumOllRow",value:function(){var e=new t;ArrStCell.forEach(function(t){e.SumOneRow(t)})}},{key:"AverageOneCol",value:function(e){var t=0;ArrStCell.forEach(function(r){t+=r[e].value}),ArrStAverage[e]=model.stAverage(t),view.PrintValue("cellAverage-"+e,Math.round(t/N))}},{key:"AverageOllColl",value:function(){for(var e=new t,r=0;r<M;r++)e.AverageOneCol(r)}},{key:"closeX",value:function(){var e=0;ArrStCell.forEach(function(t){t.forEach(function(t){ArrStSortVal[e]=model.stSortVal(t.id,t.value),e++})}),sort(ArrStSortVal,"value"),state_Init.stCellCloseElemX()}},{key:"stCellCloseElemX",value:function(){var e=void 0,t=void 0;X%2==1?(t=Math.floor(X/2),e=1):(t=X/2,e=0);var r=ArrStSortVal.length,n=0;for(var l in ArrStSortVal){var o=0,a=ArrStSortVal[n].id.split("-");if(n-t>=0&&n+t+e<r)for(var i=n-t;i<=n+t+e;i++)ArrStCell[a[0]][a[1]].range[o]=ArrStSortVal[i].id,o++;else if(n-t-e<0)for(var u=0;u<=X;u++)ArrStCell[a[0]][a[1]].range[o]=ArrStSortVal[u].id,o++;else if(n+t+e>=r)for(var s=r-1;s>=r-X-1;s--)ArrStCell[a[0]][a[1]].range[o]=ArrStSortVal[s].id,o++;n++}}}]),t}(Controller),State_EventClick=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"click",value:function(e){function t(e,t,r){for(var n in e)if(r==e[n][t])return n;return-1}function r(e,t,r){var n=Number(r),l=void 0,o=void 0;for(l=n+1;l<e.length&&e[n][t]>e[l][t];l++)o=e[n],e[n]=e[l],e[l]=o}var n=e.split("-");ArrStCell[n[0]][n[1]].value++;var l=String(ArrStCell[n[0]][n[1]].value);view.PrintValue(ArrStCell[n[0]][n[1]].id,l);var o=t(ArrStSortVal,"id",e);ArrStSortVal[o].value=ArrStCell[n[0]][n[1]].value,r(ArrStSortVal,"value",o);var a=ArrStCell[n[0]][n[1]].row;ArrStSum[a].sum++,l=String(ArrStSum[a].sum),view.PrintValue("sumRow-"+a,l);var i=ArrStCell[n[0]][n[1]].col;ArrStAverage[i].sum++,l=String(Math.round(ArrStAverage[i].sum/N)),view.PrintValue("cellAverage-"+i,l)}}]),t}(Controller),State_EventOnmouse=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"eventOnmouseover",value:function(e){function t(e){var t=e.split("-");for(var r in ArrStCell[t[0]][t[1]].range)document.getElementById(ArrStCell[t[0]][t[1]].range[r]).className="close-value-elem"}t(e)}},{key:"onmouseCloseX",value:function(e){var t=e.split("-");for(var r in ArrStCell[t[0]][t[1]].range)document.getElementById(ArrStCell[t[0]][t[1]].range[r]).className="cell"}}]),t}(Controller),State_EventSumRow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"onmouse",value:function(e){for(var t=e.split("-"),r=Number(t[1]),n=0;n<M;n++){var l=Math.round(100*ArrStCell[r][n].value/1e3);document.getElementById([r]+"-"+[n]).style.background="linear-gradient(to top, #B59EFF "+l+"%, #FFFFFF "+l+"%)",view.PrintValue([r]+"-"+[n],l)}}},{key:"outmouse",value:function(e){for(var t=e.split("-"),r=Number(t[1]),n=0;n<M;n++){var l=document.getElementById([r]+"-"+[n]);view.PrintValue([r]+"-"+[n],ArrStCell[r][n].value),l.style.background="#FFFFFF"}}}]),t}(Controller),State_EventDeleteRow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"click",value:function(e){N--;for(var t=e.split("-"),r=Number(t[1]),n=0;n<ArrStSortVal.length;n++){ArrStSortVal[n].id.split("-")[0]==r&&(ArrStSortVal.splice(n,1),n--)}delete ArrStSum[r];for(var l in ArrStAverage)ArrStAverage[l].sum-=ArrStCell[r][l].value,view.PrintValue("cellAverage-"+l,Math.round(ArrStAverage[l].sum/N));state_Init.stCellCloseElemX(),view.DeleteElem("row-"+t[1])}}]),t}(Controller),State_EventCreateRow=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"click",value:function(e){function r(){var e=void 0;for(e in ArrStCell);return ArrStCell[e][0].id.split("-")[0]}function n(e,t){this.id=e,this.value=t}N++;var l=Number(r())+1;new t;view.CreateRow(l),(new t).SumOneRow(ArrStCell[l]);for(var o in ArrStAverage)ArrStAverage[o].sum+=ArrStCell[l][o].value,view.PrintValue("cellAverage-"+o,Math.round(ArrStAverage[o].sum/N));var a=[];for(var i in ArrStCell[l])a[i]=new n(ArrStCell[l][i].id,ArrStCell[l][i].value);sort(a,"value");for(var u=0,s=0;s<ArrStSortVal.length&&!(ArrStSortVal[s].value>a[u].value&&(ArrStSortVal.splice(s,0,a[u]),++u>=a.length));s++);state_Init.stCellCloseElemX()}}]),t}(Controller),model=new Model,view=new View,state_Init=new State_Init,state_EventClick=new State_EventClick,state_EventOnmouse=new State_EventOnmouse,state_EventSumRow=new State_EventSumRow,state_EventDeleteRow=new State_EventDeleteRow,state_EventCreateRow=new State_EventCreateRow;main();